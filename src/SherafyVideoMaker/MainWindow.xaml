<Window x:Class="SherafyVideoMaker.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="Sherafy Video Maker" Height="720" Width="1080" MinHeight="640" MinWidth="980" Background="#F5F7FF">
    <Window.Resources>
        <SolidColorBrush x:Key="PrimaryBrush" Color="#0009AE" />
        <SolidColorBrush x:Key="SecondaryBrush" Color="#1A008E" />
        <LinearGradientBrush x:Key="AccentGradient" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#1A008E" Offset="0" />
            <GradientStop Color="#0009AE" Offset="1" />
        </LinearGradientBrush>
        <SolidColorBrush x:Key="CardBackground" Color="#FFFFFF" />
        <Style TargetType="Button">
            <Setter Property="Margin" Value="4" />
            <Setter Property="Padding" Value="10 8" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Foreground" Value="White" />
            <Setter Property="Background" Value="{StaticResource AccentGradient}" />
            <Setter Property="BorderBrush" Value="Transparent" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" CornerRadius="6" Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style TargetType="TextBox">
            <Setter Property="Margin" Value="4" />
            <Setter Property="Padding" Value="8" />
            <Setter Property="BorderBrush" Value="#CCD3FF" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Background" Value="#FBFCFF" />
        </Style>
        <Style TargetType="ComboBox">
            <Setter Property="Margin" Value="4" />
            <Setter Property="Padding" Value="6" />
            <Setter Property="BorderBrush" Value="#CCD3FF" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Background" Value="#FBFCFF" />
        </Style>
    </Window.Resources>
    <Grid Margin="16" IsSharedSizeScope="True">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <Border Background="{StaticResource AccentGradient}" CornerRadius="10" Padding="16" Margin="0 0 0 12">
            <DockPanel>
                <StackPanel Orientation="Horizontal" DockPanel.Dock="Right" VerticalAlignment="Center">
                    <Button Content="Load SRT" Width="110" Click="LoadSrt" />
                    <Button Content="Validate" Width="110" Click="ValidateSegments" />
                    <Button Content="Render" Width="110" Click="RenderVideo" />
                </StackPanel>
                <StackPanel Orientation="Vertical">
                    <TextBlock Text="Sherafy Video Maker" FontSize="20" FontWeight="Bold" Foreground="White" />
                    <TextBlock Text="Clean, modern workflow for pairing narration with clips" Foreground="#E8ECFF" />
                </StackPanel>
            </DockPanel>
        </Border>

        <Border Grid.Row="1" Background="{StaticResource CardBackground}" CornerRadius="12" Padding="14" Margin="0 0 0 12" BorderBrush="#E1E6FF" BorderThickness="1">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0">
                    <TextBlock Text="Input Files" FontSize="14" FontWeight="SemiBold" Foreground="{StaticResource SecondaryBrush}" Margin="4 0 4 6" />
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="120" SharedSizeGroup="Label" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="120" />
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="Audio" VerticalAlignment="Center" Grid.Column="0" />
                        <TextBox Grid.Column="1" Text="{Binding Settings.AudioPath, UpdateSourceTrigger=PropertyChanged}" />
                        <Button Grid.Column="2" Content="Browse" Click="BrowseAudio" />
                    </Grid>
                    <Grid Margin="0 6 0 0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="120" SharedSizeGroup="Label" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="120" />
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="SRT" VerticalAlignment="Center" Grid.Column="0" />
                        <TextBox Grid.Column="1" Text="{Binding Settings.SrtPath, UpdateSourceTrigger=PropertyChanged}" />
                        <Button Grid.Column="2" Content="Browse" Click="BrowseSrt" />
                    </Grid>
                    <Grid Margin="0 6 0 0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="120" SharedSizeGroup="Label" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="120" />
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="Clips Folder" VerticalAlignment="Center" Grid.Column="0" />
                        <TextBox Grid.Column="1" Text="{Binding Settings.ClipsFolder, UpdateSourceTrigger=PropertyChanged}" />
                        <Button Grid.Column="2" Content="Browse" Click="BrowseClipsFolder" />
                    </Grid>
                </StackPanel>

                <StackPanel Grid.Column="1">
                    <TextBlock Text="Downloads &amp; Preferences" FontSize="14" FontWeight="SemiBold" Foreground="{StaticResource SecondaryBrush}" Margin="4 0 4 6" />
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="100" SharedSizeGroup="Label" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="120" />
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="Clip URL" VerticalAlignment="Center" Grid.Column="0" />
                        <TextBox Grid.Column="1" Text="{Binding Settings.ClipUrl, UpdateSourceTrigger=PropertyChanged}" />
                        <Button Grid.Column="2" Content="Download" Click="DownloadClip" />
                    </Grid>
                    <Grid Margin="0 6 0 0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="100" SharedSizeGroup="Label" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="Aspect" VerticalAlignment="Center" Grid.Column="0" />
                        <ComboBox Grid.Column="1" ItemsSource="{Binding AspectOptions}" SelectedItem="{Binding Settings.AspectRatio}" />
                        <StackPanel Orientation="Horizontal" Grid.Column="2">
                            <TextBlock Text="FPS" VerticalAlignment="Center" Margin="0 0 6 0" />
                            <ComboBox Width="90" ItemsSource="{Binding FpsOptions}" SelectedItem="{Binding Settings.Fps}" />
                        </StackPanel>
                    </Grid>
                    <CheckBox Content="Use GPU when available" IsChecked="{Binding Settings.UseGpuWhenAvailable}" Margin="4 8 4 0" />
                    <Separator Margin="0 6" />
                    <TextBlock Text="Watermark" FontSize="14" FontWeight="SemiBold" Foreground="{StaticResource SecondaryBrush}" Margin="4 0 4 6" />
                    <CheckBox Content="Enable watermark" IsChecked="{Binding Settings.EnableWatermark}" Margin="4 0 4 6" />
                    <StackPanel IsEnabled="{Binding Settings.EnableWatermark}" Margin="0 0 0 4">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="100" SharedSizeGroup="Label" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="120" />
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Watermark" VerticalAlignment="Center" Grid.Column="0" />
                            <TextBox Grid.Column="1" Text="{Binding Settings.WatermarkPath, UpdateSourceTrigger=PropertyChanged}" />
                            <Button Grid.Column="2" Content="Browse" Click="BrowseWatermark" />
                        </Grid>
                        <Grid Margin="0 6 0 0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="100" SharedSizeGroup="Label" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="120" />
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Position" VerticalAlignment="Center" Grid.Column="0" />
                            <ComboBox Grid.Column="1" ItemsSource="{Binding WatermarkPositionOptions}" SelectedItem="{Binding Settings.WatermarkPosition}" />
                            <StackPanel Orientation="Horizontal" Grid.Column="2" VerticalAlignment="Center">
                                <TextBlock Text="Padding" VerticalAlignment="Center" Margin="0 0 6 0" />
                                <TextBox Width="60" Text="{Binding Settings.WatermarkPadding, UpdateSourceTrigger=PropertyChanged}" />
                            </StackPanel>
                        </Grid>
                        <Grid Margin="0 6 0 0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="100" SharedSizeGroup="Label" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="120" />
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Max Width" VerticalAlignment="Center" Grid.Column="0" />
                            <TextBox Grid.Column="1" Text="{Binding Settings.WatermarkMaxWidth, UpdateSourceTrigger=PropertyChanged}" />
                            <TextBlock Text="px (optional)" VerticalAlignment="Center" Grid.Column="2" />
                        </Grid>
                        <StackPanel Orientation="Horizontal" Margin="4 6 4 0" VerticalAlignment="Center">
                            <TextBlock Text="Opacity" VerticalAlignment="Center" Margin="0 0 8 0" />
                            <Slider Width="200" Minimum="0" Maximum="1" SmallChange="0.05" TickFrequency="0.05" IsSnapToTickEnabled="True"
                                    Value="{Binding Settings.WatermarkOpacity, UpdateSourceTrigger=PropertyChanged}" />
                            <TextBlock Text="{Binding Settings.WatermarkOpacity, StringFormat=F2}" VerticalAlignment="Center" Margin="8 0 0 0" />
                        </StackPanel>
                    </StackPanel>
                    <Separator Margin="0 8" />
                    <TextBlock Text="Background Music" FontSize="14" FontWeight="SemiBold" Foreground="{StaticResource SecondaryBrush}" Margin="4 0 4 6" />
                    <CheckBox Content="Enable background music" IsChecked="{Binding Settings.EnableBackgroundMusic}" Margin="4 0 4 6" />
                    <StackPanel IsEnabled="{Binding Settings.EnableBackgroundMusic}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="100" SharedSizeGroup="Label" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="120" />
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Audio" VerticalAlignment="Center" Grid.Column="0" />
                            <TextBox Grid.Column="1" Text="{Binding Settings.BackgroundMusicPath, UpdateSourceTrigger=PropertyChanged}" />
                            <Button Grid.Column="2" Content="Browse" Click="BrowseBackgroundMusic" />
                        </Grid>
                        <Grid Margin="0 6 0 0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="100" SharedSizeGroup="Label" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="120" />
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Start / End" VerticalAlignment="Center" Grid.Column="0" />
                            <StackPanel Orientation="Horizontal" Grid.Column="1">
                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="0 0 6 0">
                                    <TextBlock Text="Start" Margin="0 0 4 0" VerticalAlignment="Center" />
                                    <TextBox Width="80" Text="{Binding Settings.BackgroundMusicStart, UpdateSourceTrigger=PropertyChanged}" />
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                    <TextBlock Text="End" Margin="0 0 4 0" VerticalAlignment="Center" />
                                    <TextBox Width="80" Text="{Binding Settings.BackgroundMusicEnd, UpdateSourceTrigger=PropertyChanged}" />
                                </StackPanel>
                            </StackPanel>
                            <CheckBox Grid.Column="2" Content="Loop to fill video" IsChecked="{Binding Settings.BackgroundMusicLoop}" VerticalAlignment="Center" />
                        </Grid>
                        <StackPanel Orientation="Horizontal" Margin="4 6 4 0" VerticalAlignment="Center">
                            <TextBlock Text="Volume" VerticalAlignment="Center" Margin="0 0 8 0" />
                            <Slider Width="200" Minimum="0" Maximum="2" SmallChange="0.05" TickFrequency="0.05" IsSnapToTickEnabled="True"
                                    Value="{Binding Settings.BackgroundMusicVolume, UpdateSourceTrigger=PropertyChanged}" />
                            <TextBlock Text="{Binding Settings.BackgroundMusicVolume, StringFormat=F2}" VerticalAlignment="Center" Margin="8 0 0 0" />
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="4 6 4 0" VerticalAlignment="Center">
                            <TextBlock Text="Speed" VerticalAlignment="Center" Margin="0 0 8 0" />
                            <Slider Width="200" Minimum="0.5" Maximum="2" SmallChange="0.05" TickFrequency="0.05" IsSnapToTickEnabled="True"
                                    Value="{Binding Settings.BackgroundMusicSpeed, UpdateSourceTrigger=PropertyChanged}" />
                            <TextBlock Text="{Binding Settings.BackgroundMusicSpeed, StringFormat=F2}x" VerticalAlignment="Center" Margin="8 0 0 0" />
                        </StackPanel>
                    </StackPanel>
                </StackPanel>
            </Grid>
        </Border>

        <Border Grid.Row="2" Background="{StaticResource CardBackground}" CornerRadius="12" Padding="10" Margin="0 0 0 12" BorderBrush="#E1E6FF" BorderThickness="1">
            <DataGrid x:Name="SegmentsGrid" ItemsSource="{Binding Segments}" AutoGenerateColumns="False" CanUserAddRows="False" HeadersVisibility="Column"
                      GridLinesVisibility="Horizontal" RowHeaderWidth="0" AlternatingRowBackground="#F7F8FF" AllowDrop="True"
                      PreviewDragOver="SegmentsGrid_PreviewDragOver" Drop="SegmentsGrid_Drop">
                <DataGrid.Resources>
                    <Style TargetType="DataGridColumnHeader">
                        <Setter Property="Background" Value="#EEF1FF" />
                        <Setter Property="Foreground" Value="#1A1E3B" />
                        <Setter Property="FontWeight" Value="SemiBold" />
                        <Setter Property="Padding" Value="8" />
                    </Style>
                </DataGrid.Resources>
                <DataGrid.Columns>
                    <DataGridTextColumn Header="#" Binding="{Binding Index}" IsReadOnly="True" Width="40" />
                    <DataGridTextColumn Header="Start" Binding="{Binding Start}" Width="120" />
                    <DataGridTextColumn Header="End" Binding="{Binding End}" Width="120" />
                    <DataGridTextColumn Header="Duration" Binding="{Binding Duration}" IsReadOnly="True" Width="90" />
                    <DataGridTextColumn Header="Text" Binding="{Binding Text}" Width="*" />
                    <DataGridTemplateColumn Header="Assigned Clip" Width="160">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Border Background="#F5F7FF" BorderBrush="#D9E1FF" BorderThickness="1" CornerRadius="4" Padding="6" AllowDrop="True">
                                    <TextBlock Text="{Binding AssignedClip}" Foreground="#1A1E3B" />
                                </Border>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTextColumn Header="Clip URL" Binding="{Binding ClipUrl}" Width="200" />
                    <DataGridComboBoxColumn Header="Fit Mode"
                                              ItemsSource="{Binding DataContext.FitModeOptions, RelativeSource={RelativeSource AncestorType=Window}}"
                                              SelectedItemBinding="{Binding FitMode, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                              Width="120" />
                    <DataGridTextColumn Header="Speed" Binding="{Binding Speed}" Width="80" />
                </DataGrid.Columns>
            </DataGrid>
        </Border>

        <Border Grid.Row="3" Background="{StaticResource CardBackground}" CornerRadius="12" Padding="8" BorderBrush="#E1E6FF" BorderThickness="1">
            <StackPanel>
                <TextBlock Text="Log" FontWeight="SemiBold" Foreground="{StaticResource SecondaryBrush}" Margin="4 0 4 6" />
                <TextBox Text="{Binding LogText}" AcceptsReturn="True" VerticalScrollBarVisibility="Auto" Height="140" IsReadOnly="True" TextWrapping="Wrap" />
            </StackPanel>
        </Border>
    </Grid>
</Window>
